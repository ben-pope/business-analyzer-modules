!function(e){"use strict";e.businessAnalyzer=e.businessAnalyzer||{},e.businessAnalyzer.displayCompetitorAnalysis=function(t){e.businessAnalyzer.currentBusiness;const a=document.getElementById("competitorSection");if(!t||!t.competitors||0===t.competitors.length)return void(a.style.display="none");if(document.getElementById("competitorCount").textContent=t.competitors.length,t.marketAnalysis){document.getElementById("marketSaturation").textContent=t.marketAnalysis.marketSaturation||"-";let e=t.marketAnalysis.avgRating;if(null==e){const a=t.competitors.filter(e=>e.rating&&e.rating>0).map(e=>e.rating);a.length>0&&(e=a.reduce((e,t)=>e+t,0)/a.length)}document.getElementById("avgCompetitorRating").textContent=null!=e&&e>0?e.toFixed(1):"-"}!function(){const t=(e.businessAnalyzer.currentBusiness||{}).reviews||[];if(0===t.length)return void(document.getElementById("timeSinceLastReview").textContent="No reviews");let a=null;for(const e of t)if(e.publishTime){const t=new Date(e.publishTime);(!a||t>a)&&(a=t)}if(!a)return void(document.getElementById("timeSinceLastReview").textContent="Unknown");const i=new Date,n=Math.floor((i-a)/864e5);let s="";if(0===n)s="Last review: Today";else if(1===n)s="Last review: 1 day ago";else if(n<7)s=`Last review: ${n} days ago`;else if(n<30){const e=Math.floor(n/7);s=1===e?"Last review: 1 week ago":`Last review: ${e} weeks ago`}else if(n<365){const e=Math.floor(n/30);s=1===e?"Last review: 1 month ago":`Last review: ${e} months ago`}else{const e=Math.floor(n/365);s=1===e?"Last review: 1 year ago":`Last review: ${e} years ago`}document.getElementById("timeSinceLastReview").textContent=s}();const i=document.getElementById("competitorList"),n=t.competitors.map(e=>{const t=`ba-threat-${e.threatLevel||"low"}`,a=Math.min(100,e.marketStrength||0);return`\n        <div class="ba-competitor-card ${t}">\n          <div class="ba-competitor-header">\n            <h4 class="ba-competitor-name">${e.name}</h4>\n            <div class="ba-threat-badge ba-threat-${e.threatLevel||"low"}">\n              ${(e.threatLevel||"low").charAt(0).toUpperCase()+(e.threatLevel||"low").slice(1)} Risk\n            </div>\n          </div>\n\n          <div class="ba-competitor-info">\n            <p class="ba-competitor-address">${e.address||"Address not available"}</p>\n            <p class="ba-competitor-distance">üìç ${e.distanceFormatted||"Distance unknown"}</p>\n\n            <div class="ba-competitor-stats">\n              <div class="ba-stat-item">\n                <span class="ba-stat-value">‚≠ê ${e.rating||"N/A"}</span>\n                <span class="ba-stat-text">(${e.reviewCount||0} reviews)</span>\n              </div>\n              ${e.website?`<div class="ba-stat-item">üåê <a href="${e.website}" target="_blank" rel="noopener">${function(e){try{return new URL(e).hostname.replace("www.","")}catch(e){return"Visit Website"}}(e.website)}</a></div>`:""}\n            </div>\n\n            <div class="ba-strength-meter">\n              <div class="ba-strength-label">Market Strength: ${e.marketStrength||0}%</div>\n              <div class="ba-strength-bar">\n                <div class="ba-strength-fill" style="width: ${a}%"></div>\n              </div>\n            </div>\n\n            ${e.practiceAreas&&e.practiceAreas.length>0?`<div class="ba-practice-areas">\n                <div class="ba-practice-label">Practice Areas:</div>\n                <div class="ba-practice-tags">\n                  ${e.practiceAreas.map(e=>`<span class="ba-practice-tag">${e}</span>`).join("")}\n                </div>\n              </div>`:""}\n\n            ${e.description?`<p class="ba-competitor-description">${e.description}</p>`:""}\n          </div>\n        </div>\n      `}).join("");i.innerHTML=n,function(t){const a=e.businessAnalyzer.currentBusiness||{},i=document.getElementById("marketInsightsList");if(!t)return void(i.innerHTML="<p>Market analysis not available</p>");const n=[];if(t.totalCompetitors){let e="";switch(t.marketSaturation){case"High":e=`‚ö†Ô∏è High competition: ${t.totalCompetitors} competitors found. Focus on differentiation.`;break;case"Medium":e=`‚ö° Moderate competition: ${t.totalCompetitors} competitors. Good opportunity for growth.`;break;default:e=`‚úÖ Low competition: Only ${t.totalCompetitors} competitors. Great opportunity!`}n.push(e)}if(void 0!==t.avgRating&&null!==t.avgRating&&a.rating){const e=a.rating-t.avgRating;e>.3?n.push(`‚≠ê Your rating (${a.rating}) is above market average (${t.avgRating.toFixed(1)})`):e<-.3?n.push(`üìà Room for improvement: Market average rating is ${t.avgRating.toFixed(1)}, yours is ${a.rating}`):n.push(`‚öñÔ∏è Your rating (${a.rating}) matches market average (${t.avgRating.toFixed(1)})`)}if(t.avgReviews&&a.reviewCount){const e=a.reviewCount-t.avgReviews;e>20?n.push(`üí™ Strong review presence: ${a.reviewCount} reviews vs market average of ${t.avgReviews}`):e<-20&&n.push(`üìù Focus on review generation: You have ${a.reviewCount} reviews, market average is ${t.avgReviews}`)}t.strongCompetitors>0&&n.push(`üèÜ ${t.strongCompetitors} competitors have strong online presence (70%+ market strength)`),t.nearbyCompetitors>0&&n.push(`üìç ${t.nearbyCompetitors} competitors within 0.5 miles - local SEO is critical`);const s=n.map(e=>`<div class="ba-market-insight">${e}</div>`).join("");i.innerHTML=s||"<p>No specific insights available</p>"}(t.marketAnalysis),t.competitors&&t.competitors.length>0&&e.moduleLoader.load("maps.js",function(a){!a&&e.businessAnalyzer.initCompetitorMap?e.businessAnalyzer.initCompetitorMap(t.competitors):a&&console.error("Failed to load maps module:",a)}),a.style.display="block"}}(window);