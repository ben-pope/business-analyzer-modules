!function(e){"use strict";async function t(t){t.preventDefault();const a=t.target,n=document.getElementById("strategy-submit-btn"),l=n.querySelector(".ba-submit-text"),s=n.querySelector(".ba-submit-loading"),r=document.getElementById("strategy-form-success"),i=document.getElementById("strategy-form-error");l.style.display="none",s.style.display="flex",n.disabled=!0,r.style.display="none",i.style.display="none";try{const t=new FormData(a),n=Object.fromEntries(t.entries()),l=await async function(t){try{const o=e.getUTMParameters||function(){const t=new URLSearchParams(e.location.search);return{utm_source:t.get("utm_source")||"",utm_medium:t.get("utm_medium")||"",utm_campaign:t.get("utm_campaign")||"",gclid:t.get("gclid")||""}},a=e.getCookie||function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},n=o(),l=a("hubspotutk"),s=document.getElementById("persistentURL"),r=s?s.value:"",i={fields:[{name:"firstname",value:t.firstname||""},{name:"lastname",value:t.lastname||""},{name:"email",value:t.email||""},{name:"phone",value:t.phone||""},{name:"preferred_meeting_date",value:t.preferred_meeting_date||""},{name:"preferred_time_of_day",value:t.preferred_time_of_day||""},{name:"message",value:t.message||""},{name:"company",value:t.company||""},{name:"website",value:t.website||""},{name:"address",value:t.address||""},{name:"city",value:t.city||""},{name:"state",value:t.state||""},{name:"country",value:t.country||""},{name:"zip",value:t.zip||""},{name:"company_phone",value:t.company_phone||""},{name:"google_place_id",value:t.google_place_id||""},{name:"online_presence_report_link",value:t.online_presence_report_link||r},{name:"utm_source",value:n.utm_source||""},{name:"utm_medium",value:n.utm_medium||""},{name:"utm_campaign",value:n.utm_campaign||""},{name:"gclid",value:n.gclid||""}],context:{pageUri:e.location.href,pageName:document.title,hutk:l}},m=await fetch("https://api.hsforms.com/submissions/v3/integration/submit/4465199/0167a0c9-6263-4850-9d54-e95f8590dea3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(m.ok)return{success:!0};{const e=await m.text();return{success:!1,error:`HubSpot API error: ${m.status} ${e}`}}}catch(e){return console.error("HubSpot strategy call submission error:",e),{success:!1,error:e.message}}}(n);if(!l.success)throw new Error(l.error||"Failed to submit strategy call request");e.trackEvent&&e.trackEvent("strategy_call_form_submitted",{hubspot_submission:"success"}),r.style.display="block",setTimeout(()=>{o()},3e3)}catch(e){console.error("Strategy call form submission error:",e),i.textContent=`Error: ${e.message}. Please try again or contact support.`,i.style.display="block",l.style.display="inline",s.style.display="none",n.disabled=!1}}function o(){const e=document.getElementById("strategyCallModal");if(e){e.style.display="none";const t=document.getElementById("strategyCallForm");if(t){t.reset(),document.getElementById("strategy-form-success").style.display="none",document.getElementById("strategy-form-error").style.display="none";const e=document.getElementById("strategy-submit-btn"),o=e.querySelector(".ba-submit-text"),a=e.querySelector(".ba-submit-loading");o.style.display="inline",a.style.display="none",e.disabled=!1,document.getElementById("strategy-date").value="",document.getElementById("strategy-time").value="";const n=document.querySelector(".ba-strategy-call-modal .ba-modal-header p");n&&(n.innerHTML="Let's discuss how to boost your online presence and beat your competition.")}}}function a(){["strategy-firstname","strategy-lastname","strategy-email","strategy-phone"].forEach(e=>{const t=document.getElementById(e);if(t){const o=t.closest(".ba-form-field");o&&(o.style.display="block",console.log(`âœ… Showing field: ${e}`))}});const e=document.querySelector(".ba-strategy-call-modal .ba-modal-header p");e&&(e.innerHTML="Update your contact information and select your preferred meeting time."),console.log("ðŸ“ Contact fields are now visible for editing")}function n(){l()}function l(){const o=document.getElementById("strategyCallModal");if(o){e.trackEvent&&e.trackEvent("strategy_call_modal_displayed",{source:"cta_button"}),function(){console.log("ðŸ”„ Starting populateStrategyCallForm()...");const t=document.getElementById("strategy-firstname"),o=document.getElementById("strategy-lastname"),a=document.getElementById("strategy-email"),n=document.getElementById("strategy-phone");console.log("ðŸ” Strategy form fields found:",{firstnameField:!!t,lastnameField:!!o,emailField:!!a,phoneField:!!n});const l=document.getElementById("form-firstname"),s=document.getElementById("form-lastname"),r=document.getElementById("form-email"),i=document.getElementById("form-phone");console.log("ðŸ” Report form fields found:",{reportFirstname:!!l,reportLastname:!!s,reportEmail:!!r,reportPhone:!!i});let m=!1;const c=localStorage.getItem("ba_user_firstname"),u=localStorage.getItem("ba_user_lastname"),d=localStorage.getItem("ba_user_email"),g=localStorage.getItem("ba_user_phone");if(console.log("ðŸ” localStorage values retrieved:",{storedFirstname:c,storedLastname:u,storedEmail:d,storedPhone:g}),c&&t){t.value=c,m=!0,console.log("âœ… Auto-populated firstname from localStorage:",c);const e=t.closest(".ba-form-field");e&&(e.style.display="none")}else console.log("âŒ Could not populate firstname - stored:",c,"field:",!!t);if(u&&o){o.value=u,m=!0,console.log("âœ… Auto-populated lastname from localStorage:",u);const e=o.closest(".ba-form-field");e&&(e.style.display="none")}else console.log("âŒ Could not populate lastname - stored:",u,"field:",!!o);if(d&&a){a.value=d,m=!0,console.log("âœ… Auto-populated email from localStorage:",d);const e=a.closest(".ba-form-field");e&&(e.style.display="none")}else console.log("âŒ Could not populate email - stored:",d,"field:",!!a);if(g&&n){n.value=g,m=!0,console.log("âœ… Auto-populated phone from localStorage:",g);const e=n.closest(".ba-form-field");e&&(e.style.display="none")}else console.log("âŒ Could not populate phone - stored:",g,"field:",!!n);!t.value&&l&&l.value&&(t.value=l.value,m=!0),!o.value&&s&&s.value&&(o.value=s.value,m=!0),!a.value&&r&&r.value&&(a.value=r.value,m=!0),!n.value&&i&&i.value&&(n.value=i.value,m=!0);const y=e.businessAnalyzer.currentBusiness||{};if(y){const e=document.getElementById("strategy-company");e&&(e.value=y.name||"");const t=document.getElementById("strategy-website");t&&(t.value=y.website||"");const o=document.getElementById("strategy-address"),a=document.getElementById("strategy-city"),n=document.getElementById("strategy-state"),l=document.getElementById("strategy-country"),s=document.getElementById("strategy-zip");o&&(o.value=y.formattedAddress||y.address||""),y.addressComponents&&y.addressComponents.forEach(e=>{const t=e.types||[];t.includes("locality")&&a&&(a.value=e.longName||e.shortName||""),t.includes("administrative_area_level_1")&&n&&(n.value=e.shortName||e.longName||""),t.includes("country")&&l&&(l.value=e.longName||e.shortName||""),t.includes("postal_code")&&s&&(s.value=e.longName||e.shortName||"")});const r=document.getElementById("strategy-company-phone");r&&(r.value=y.internationalPhoneNumber||y.nationalPhoneNumber||y.phone||"");const i=document.getElementById("strategy-google-place-id");i&&(i.value=y.id||y.placeId||"");const m=document.getElementById("strategy-report-link");if(m){const e=document.getElementById("persistentURL"),t=e?e.value:"";m.value=t}}const p=(e.getUTMParameters||function(){const t=new URLSearchParams(e.location.search);return{utm_source:t.get("utm_source")||"",utm_medium:t.get("utm_medium")||"",utm_campaign:t.get("utm_campaign")||"",gclid:t.get("gclid")||""}})(),f=document.getElementById("strategy-utm-source"),v=document.getElementById("strategy-utm-medium"),b=document.getElementById("strategy-utm-campaign"),h=document.getElementById("strategy-gclid");f&&(f.value=p.utm_source||""),v&&(v.value=p.utm_medium||""),b&&(b.value=p.utm_campaign||""),h&&(h.value=p.gclid||"");const _=document.querySelector(".ba-strategy-call-modal .ba-modal-header p");_&&(_.innerHTML=m?'We\'ve saved your contact information from earlier. Just select your preferred meeting time! <br><small style="color: #666; font-size: 14px;">Your info: '+[c,u].filter(Boolean).join(" ")+(d?" â€¢ "+d:"")+' â€¢ <a href="#" onclick="showContactFields()" style="color: #4A90E2; text-decoration: underline; cursor: pointer;">Update contact info</a></small>':"Please provide your contact information and preferred meeting time."),console.log("ðŸ”„ Final form field values after population:",{firstname:t?t.value:"field not found",lastname:o?o.value:"field not found",email:a?a.value:"field not found",phone:n?n.value:"field not found",hasAutoPopulatedUserData:m}),console.log("âœ… populateStrategyCallForm() completed")}(),function(){const e=document.getElementById("strategy-date");if(e){const t=(new Date).toISOString().split("T")[0];e.min=t;const o=e.closest(".ba-form-field");if(o){o.style.cursor="pointer";let a=!1;function n(t){if(t.target!==e&&!a){if(a=!0,t.preventDefault(),t.stopPropagation(),e.showPicker)try{e.showPicker(),console.log("âœ… Date picker opened via showPicker()")}catch(t){e.focus(),console.log("âœ… Date picker opened via focus (showPicker not supported)")}else e.focus(),console.log("âœ… Date picker opened via focus (fallback)");setTimeout(()=>{a=!1},300)}}o.addEventListener("click",n),console.log("ðŸ“… Enhanced date picker click handling initialized")}}}(),o.style.display="flex";const a=document.getElementById("strategyCallForm");if(a){a.onsubmit=null,a.addEventListener("submit",t);let o=!1;["strategy-firstname","strategy-lastname","strategy-email","strategy-phone"].forEach(t=>{const a=document.getElementById(t);a&&a.addEventListener("input",function(){!o&&e.trackEvent&&(e.trackEvent("strategy_call_form_started",{first_field:t}),o=!0)},{once:!1})})}}}e.businessAnalyzer=e.businessAnalyzer||{},e.businessAnalyzer.showStrategyCallModal=l,e.businessAnalyzer.hideStrategyCallModal=o,e.businessAnalyzer.showContactFields=a,e.businessAnalyzer.handleBookingClick=n,e.showStrategyCallModal=l,e.hideStrategyCallModal=o,e.showContactFields=a,e.handleBookingClick=n}(window);